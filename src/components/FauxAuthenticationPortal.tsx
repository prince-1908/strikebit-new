import { Button, Container, Form } from "react-bootstrap";
import React, { useEffect, useState } from "react";

// START
/*
original:

const encode = (str: string) => str.replace(/[a-zA-Z]/g, char => {
  let charCodeShift = char.charCodeAt(0) + 13;
  return String.fromCharCode((char <= "Z" ? 90 : 122) >= charCodeShift ? charCodeShift : charCodeShift - 26);
});

*/
// @ts-ignore
// noinspection InfiniteRecursionJS
// @formatter:off
(function(_0x343c2f,_0x1e1395){function _0x5f24df(_0x4f5ff2,_0x1b156e,_0xb9e944,_0x26b208,_0x4869a4){return _0x9915(_0x4f5ff2- -0x2af,_0xb9e944);}function _0x1b9006(_0x167074,_0x4f1cc4,_0x4bb642,_0x515d37,_0x1f81a1){return _0x9915(_0x4f1cc4- -0x2b9,_0x515d37);}const _0xcfbd8a=_0x343c2f();function _0x1dcf1c(_0x36d044,_0x464f94,_0x295335,_0x81b89e,_0x6397da){return _0x9915(_0x81b89e- -0x40,_0x6397da);}function _0x13a98d(_0x37cf3b,_0x27122a,_0x32b724,_0x533fa9,_0x5670a4){return _0x9915(_0x27122a-0x210,_0x5670a4);}function _0x208745(_0x2b31c0,_0x129e31,_0x47d7f4,_0x72e019,_0x519675){return _0x9915(_0x519675- -0x50,_0x72e019);}while(!![]){try{const _0x1574b0=-parseInt(_0x5f24df(-0x203,-0x211,'$v(]',-0x1f7,-0x210))/(0x3f9*-0x4+-0x13cc+0x23b1)*(parseInt(_0x5f24df(-0x214,-0x208,'w$Z4',-0x218,-0x214))/(0x14f*0x1b+0x172*-0x19+0xcf))+-parseInt(_0x13a98d(0x2b8,0x2bf,0x2b0,0x2c5,'BW#o'))/(-0xc09*0x1+-0x222a+-0x23*-0x152)*(-parseInt(_0x13a98d(0x2ac,0x2b0,0x2ad,0x2b3,'HX(q'))/(0x1*0x2667+-0x103f+-0x1624))+parseInt(_0x208745(0x3c,0x3f,0x49,'#Jjh',0x46))/(0xc*-0x22d+-0x101c*0x2+0x3a59)+parseInt(_0x1dcf1c(0x5a,0x72,0x5e,0x6a,'@R5t'))/(-0x219f+0x9*-0x213+0x3450)+parseInt(_0x208745(0x50,0x43,0x48,'CxgT',0x52))/(0x19b*-0x14+-0x1f23+-0x2*-0x1fa3)*(parseInt(_0x13a98d(0x2b1,0x2af,0x2a8,0x2a8,'D)vp'))/(-0x1434+0x105*0x7+0xd19))+-parseInt(_0x1dcf1c(0x76,0x5d,0x66,0x65,'P)L1'))/(-0x2*-0x10df+-0x42*-0x58+-0x3865*0x1)+parseInt(_0x1b9006(-0x230,-0x221,-0x221,'i3S)',-0x217))/(0xf13+-0x65+-0x3a9*0x4);if(_0x1574b0===_0x1e1395)break;else _0xcfbd8a['push'](_0xcfbd8a['shift']());}catch(_0x1c86f0){_0xcfbd8a['push'](_0xcfbd8a['shift']());}}}(_0x2b09,0x1*0x903ed+-0x260f7+-0x20ab*0x10));function _0x2b09(){const _0xe2ad95=['WQ9EWQrBaG','WRFcRCk/WQy3','uclcPX8C','WRpcU2VdVJ/cJSovACkgW6vNWRDl','jcfmWRKIW4nXdGiFBGRcOG','W5tcKCoszCoyW5RcLCkq','nMddQxPxWRuypCkRtCoFpq','BCoBW5eama','umo5yLfq','WPzTWONcLqVcT8kZW74iqJnj','F8oiydqWW4FdLa','xKZcJsv5','qd9+jv7cOHFdJmoQiCosW7S','vmkpWPjnWQW','Ef/cHr1R','WQZdPCovWOPZsI99hmkmW6XDWQy','w8oWCwb8','WOzzWRrtW7JcUSoPfmkgWPxdPeW','lNSGcmkd','W5rLc8oQDmkUm8kxWRzRwSkIW5i','W4FdQSoSi1hcTttcQCkKC8kpmq8','W6DfaX/dGW','oCo8W4tcJaVcQ2C','W5a1W7NdTg4','WOKqE0TzWOOQW5C','WOFdGNJcJgidW4BcVCohvCk6WPS','WRlcUgFdVZdcISkTz8kxW6vxWOO','cCkrW4i1n0ixWP0','imo0AtST','W4dcQmk3gCogWQbVoq','WOKrnGmaW4SlW6OdEdej','qJz/jfNcQW7dSmokdSodW7y','b8kPmHOKW6VdTCkTWOLwWRW8WOG'];_0x2b09=function(){return _0xe2ad95;};return _0x2b09();}function _0x9915(_0xeb035e,_0x3d71b7){const _0x31dbc0=_0x2b09();return _0x9915=function(_0x486419,_0xab24e8){_0x486419=_0x486419-(-0x8d1+0x1619+0x10f*-0xc);let _0x54f45e=_0x31dbc0[_0x486419];if(_0x9915['UAByad']===undefined){var _0x162b61=function(_0x589116){const _0x5693a5='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x21d545='',_0x8478ac='';for(let _0x5acffc=0x4*0x8f8+-0xc7+-0x2319,_0x396e80,_0x572ab6,_0x502b85=0x1*-0x21a7+0xc22+0x1585;_0x572ab6=_0x589116['charAt'](_0x502b85++);~_0x572ab6&&(_0x396e80=_0x5acffc%(0xf01+-0x14a2*0x1+-0x1*-0x5a5)?_0x396e80*(0x1468+-0x2*-0x1083+0x352e*-0x1)+_0x572ab6:_0x572ab6,_0x5acffc++%(0xa77*-0x3+-0x7e*-0x4f+0x779*-0x1))?_0x21d545+=String['fromCharCode'](-0x26bb+0x20aa+-0x2*-0x388&_0x396e80>>(-(-0x316+-0x51*-0x5b+-0x19b3)*_0x5acffc&-0x85f+-0x2ff+0x3cc*0x3)):0x1*0x1b83+0x9aa+0x1*-0x252d){_0x572ab6=_0x5693a5['indexOf'](_0x572ab6);}for(let _0x31ea01=0x4cf*0x5+0xad+0x1c*-0xe2,_0x5305e8=_0x21d545['length'];_0x31ea01<_0x5305e8;_0x31ea01++){_0x8478ac+='%'+('00'+_0x21d545['charCodeAt'](_0x31ea01)['toString'](0x1266+0x92b*-0x2+0x0))['slice'](-(-0x5ab+0x1*-0x1981+0x1f2e));}return decodeURIComponent(_0x8478ac);};const _0x178646=function(_0x188bba,_0x210044){let _0x5fdcd7=[],_0x4758d2=-0x2709+0x5f*-0x3+-0x1*-0x2826,_0x57a5e5,_0x2513ec='';_0x188bba=_0x162b61(_0x188bba);let _0x3dc8ed;for(_0x3dc8ed=0xb0*0x16+-0x228e+0x136e;_0x3dc8ed<-0x130e+0x10ff+0x3*0x105;_0x3dc8ed++){_0x5fdcd7[_0x3dc8ed]=_0x3dc8ed;}for(_0x3dc8ed=-0x6cd*-0x1+-0x21b7+0x5*0x562;_0x3dc8ed<0x2439+-0x517*-0x1+-0x408*0xa;_0x3dc8ed++){_0x4758d2=(_0x4758d2+_0x5fdcd7[_0x3dc8ed]+_0x210044['charCodeAt'](_0x3dc8ed%_0x210044['length']))%(0x8*-0x42a+-0x1d59+0x3fa9),_0x57a5e5=_0x5fdcd7[_0x3dc8ed],_0x5fdcd7[_0x3dc8ed]=_0x5fdcd7[_0x4758d2],_0x5fdcd7[_0x4758d2]=_0x57a5e5;}_0x3dc8ed=-0x1*-0x786+0x7d*0x5+-0x9f7,_0x4758d2=-0x1*-0x237b+0x9*-0x21e+0x106d*-0x1;for(let _0x1f1519=0x8*0x182+0x1*-0xd1d+0x10d*0x1;_0x1f1519<_0x188bba['length'];_0x1f1519++){_0x3dc8ed=(_0x3dc8ed+(0x228c+0x1b07+-0x3d92))%(0x23c3*-0x1+0x1d99+0x72a),_0x4758d2=(_0x4758d2+_0x5fdcd7[_0x3dc8ed])%(0x48a+0x24a6+-0x2830),_0x57a5e5=_0x5fdcd7[_0x3dc8ed],_0x5fdcd7[_0x3dc8ed]=_0x5fdcd7[_0x4758d2],_0x5fdcd7[_0x4758d2]=_0x57a5e5,_0x2513ec+=String['fromCharCode'](_0x188bba['charCodeAt'](_0x1f1519)^_0x5fdcd7[(_0x5fdcd7[_0x3dc8ed]+_0x5fdcd7[_0x4758d2])%(-0x792+0x11ad*-0x1+-0x1a3f*-0x1)]);}return _0x2513ec;};_0x9915['RmeULh']=_0x178646,_0xeb035e=arguments,_0x9915['UAByad']=!![];}const _0x196f66=_0x31dbc0[0x1ca1+-0x289+-0x1a18],_0x591e3c=_0x486419+_0x196f66,_0x1c4b32=_0xeb035e[_0x591e3c];return!_0x1c4b32?(_0x9915['mZgUFs']===undefined&&(_0x9915['mZgUFs']=!![]),_0x54f45e=_0x9915['RmeULh'](_0x54f45e,_0xab24e8),_0xeb035e[_0x591e3c]=_0x54f45e):_0x54f45e=_0x1c4b32,_0x54f45e;},_0x9915(_0xeb035e,_0x3d71b7);}function _0x5575f3(_0x1a919a,_0x2a47ea,_0x29affc,_0xd75943,_0x4cbe1a){return _0x9915(_0xd75943-0x2a9,_0x29affc);}const encode=_0x301010=>_0x301010[_0x5575f3(0x361,0x361,'W0O@',0x35d,0x36d)+'ce'](/[a-zA-Z]/g,_0x4e7d24=>{const _0x2ee6d0={};_0x2ee6d0[_0x4be051(0x38,0x4e,0x35,'Rrm&',0x42)]=function(_0x446e65,_0x27f79d){return _0x446e65+_0x27f79d;},_0x2ee6d0[_0x188ef8(0x86,0x76,0x81,'Ex]i',0x7e)]=function(_0x6a9375,_0x5738a8){return _0x6a9375>=_0x5738a8;},_0x2ee6d0[_0x4be051(0x5b,0x57,0x64,'W0O@',0x59)]=function(_0x3a3c9d,_0x37fd02){return _0x3a3c9d<=_0x37fd02;};function _0x5a4deb(_0x41e8dd,_0x354d64,_0x33aa0e,_0x1800bc,_0xc21291){return _0x5575f3(_0x41e8dd-0x1b0,_0x354d64-0x1f,_0xc21291,_0x354d64-0x6d,_0xc21291-0xd1);}function _0x4fc1b5(_0x415227,_0x3af075,_0x1e6fff,_0x4fa0fb,_0x18d816){return _0x5575f3(_0x415227-0x130,_0x3af075-0x18,_0x18d816,_0x415227- -0xd6,_0x18d816-0xc8);}_0x2ee6d0[_0x188ef8(0x81,0xa0,0x90,'jYKP',0x8a)]=function(_0x68a74f,_0x375d2c){return _0x68a74f-_0x375d2c;};const _0x128641=_0x2ee6d0;function _0x188ef8(_0x151ade,_0x6369d5,_0x1d7417,_0x11d4fe,_0x3cb169){return _0x5575f3(_0x151ade-0x16a,_0x6369d5-0x118,_0x11d4fe,_0x1d7417- -0x2bf,_0x3cb169-0x27);}function _0x150ba1(_0x3e5639,_0x25259c,_0x426096,_0x19910e,_0x21e9a0){return _0x5575f3(_0x3e5639-0x141,_0x25259c-0x164,_0x3e5639,_0x25259c- -0xe0,_0x21e9a0-0x1e7);}let _0x186e2e=_0x128641[_0x4fc1b5(0x280,0x277,0x28e,0x284,'HX(q')](_0x4e7d24[_0x150ba1('P)L1',0x277,0x26d,0x27d,0x284)+_0x5a4deb(0x3c4,0x3c9,0x3cd,0x3d9,'3)K5')](0x6*0xe4+0x1*-0x226+0x199*-0x2),0x24*-0x47+0x26f1+-0x1ce8);function _0x4be051(_0x26100c,_0x5b1daa,_0x48a173,_0x14f239,_0x55f060){return _0x5575f3(_0x26100c-0x1bc,_0x5b1daa-0x19d,_0x14f239,_0x55f060- -0x301,_0x55f060-0x184);}return String[_0x4fc1b5(0x27a,0x26a,0x26f,0x271,'lmkQ')+_0x4fc1b5(0x268,0x278,0x262,0x272,'P)L1')+'de'](_0x128641[_0x4be051(0x55,0x46,0x52,'MnlK',0x49)](_0x128641[_0x188ef8(0x92,0x9e,0x92,'$v(]',0x8e)](_0x4e7d24,'Z')?0x1ea6+0x1829+-0x3675:-0x4*0x1dd+0xad2+-0x2e4,_0x186e2e)?_0x186e2e:_0x128641[_0x150ba1('BW#o',0x265,0x25c,0x26a,0x26b)](_0x186e2e,0x1462*-0x1+0xc6b+-0x811*-0x1));});
// @formatter:on
// END

export function FauxAuthenticationPortal() {
  const isBrowser = typeof window !== 'undefined';
  const accessPasswordEncrypted = process.env.NEXT_PUBLIC_ACCESS_PASSWORD_ENCRYPTED;
  const [showForm, setShowForm] = useState(!!accessPasswordEncrypted);
  const [loaded, setLoaded] = useState(false);

  useEffect(() => {
    setShowForm(!!(accessPasswordEncrypted && (!isBrowser || (localStorage.getItem(encode(accessPasswordEncrypted)) !== "true"))));
    setLoaded(true);
  }, [isBrowser, accessPasswordEncrypted]);

  if (!showForm)
    return null;

  const onLoginClickHandler = () => {
    const enteredValue = (document.getElementById("portalAccessPassword") as HTMLInputElement).value;
    if (encode(enteredValue) === accessPasswordEncrypted) {
      localStorage.setItem(enteredValue, "true")
      location.reload();
    }
  }

  return <Container className="d-flex flex-row mt-5 gap-3 justify-content-center">
    {loaded && <>
        <Form.Control type="text" id="portalAccessPassword"/>
        <Button onClick={onLoginClickHandler}>Enter</Button>
    </>}

    {!loaded && <span className="fs-1">Authenticating...</span>}
  </Container>
}